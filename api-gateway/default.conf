server {
    listen 8000;
    server_name localhost;

    # Health checks
    location /health {
        return 200 '{"status":"UP", "gateway": "cloudretail-nginx"}';
        add_header Content-Type application/json;
    }

    # Proxy settings helper
    # We can't use include inside location if we want to change proxy_pass easily
    # so we'll just repeat the include cors.conf

    location /api/v1/auth {
        include /etc/nginx/cors.include;
        proxy_pass http://user-service:3001;
    }

    location /api/v1/users {
        include /etc/nginx/cors.include;
        proxy_pass http://user-service:3001;
    }

    location /api/v1/products {
        include /etc/nginx/cors.include;
        proxy_pass http://product-service:3002;
    }

    location /api/v1/categories {
        include /etc/nginx/cors.include;
        proxy_pass http://product-service:3002;
    }

    location /api/v1/inventory {
        include /etc/nginx/cors.include;
        proxy_pass http://inventory-service:3003;
    }

    location /api/v1/orders {
        include /etc/nginx/cors.include;
        proxy_pass http://order-service:3004;
    }

    location /api/v1/payments {
        include /etc/nginx/cors.include;
        proxy_pass http://payment-service:3005;
    }

    # Swagger Documentation for Product Service
    location /docs/products/ {
        proxy_pass http://product-service:3002/api-docs/;
        proxy_set_header Host $host;
    }



    # Global proxy settings
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
